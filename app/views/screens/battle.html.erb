<% content_for :body_class, "battle-view-only" %>

<div class="story-view-wrapper">
  <div class="story-view-bg title-bg">
    <p style="color:#fff; font-size: 32px; text-align:center; margin-top: 40vh;">
      （ここにバトル用の敵立ち絵 + 背景を出す）
    </p>
  </div>
</div>

<script>
  (function() {
    // いま開いている画面がどのモードか（初期値）
    var currentMode = "<%= session[:screen_mode].presence || 'title' %>";

    function pathForMode(mode) {
      switch (mode) {
        case 'title':
          return "<%= screen_title_path %>";
        case 'character':
          return "<%= screen_character_path %>";
        case 'story':
          return "<%= screen_story_path %>";
        case 'battle':
          return "<%= screen_battle_path %>";
        default:
          return "<%= screen_title_path %>";
      }
    }

    async function checkMode() {
      try {
        const res  = await fetch("<%= screen_mode_path %>", { cache: "no-store" });
        if (!res.ok) return;

        const mode = (await res.text()).trim();
        if (!mode || mode === currentMode) return;

        // モードが変わっていたら、対応する /screen/xxx に飛び直す
        currentMode = mode;
        window.location.href = pathForMode(mode);
      } catch (e) {
        console.warn("screen mode check failed", e);
      }
    }

    // 2秒ごとに確認（お好みで 1000〜3000ms に調整）
    setInterval(checkMode, 2000);
  })();
</script>