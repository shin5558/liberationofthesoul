<h1>ゴブリン撃破後</h1>

<section id="after-goblin-script">
  <p class="prologue-line is-fairy"
     data-line-id="fairy_1">
    「やったぁ――！ ゴブリンを倒したよ！」
  </p>

  <p class="prologue-line is-fairy"
     data-line-id="fairy_2">
    「<strong><%= current_player&.name_kana || "あなた" %></strong>、お疲れ様。<br>
     戦いで疲れたでしょ、ちょっと回復しておくね。」
  </p>

  <p class="prologue-line is-narrator"
     data-line-id="narrator_1">
    リュミエルがそっと手を差し伸べると、柔らかな光が舞い上がり、<br>
    あなたの身体を包み込む。重かった身体が、少しずつ軽くなっていく。
  </p>

  <p class="prologue-line is-fairy"
     data-line-id="fairy_3">
    「あっ、ほら。馬車の中、何か光ってるよ……！」
  </p>

  <p class="prologue-line is-narrator"
     data-line-id="narrator_2">
    倒れた馬車の荷台には、淡く光を放つカードセットが転がっていた。<br>
    まるで、持ち主を待っていたかのように。
  </p>

  <p class="prologue-line is-fairy"
     data-line-id="fairy_4">
    「じゃーん！ 『属性カード』だよ。<br>
     誰でも使える便利なカードだから、きっと役に立つはず！」
  </p>

  <p class="prologue-line is-narrator"
     data-line-id="narrator_3">
    あなたはカードを受け取り、そっとデッキにしまった。<br>
    心なしか、指先に温かな力が宿ったように感じる。
  </p>

  <p class="prologue-line is-fairy"
     data-line-id="fairy_5">
    「よし、ひと段落ついたね。<br>
     でも、道はまだ続いてる……この先には、門番の砦があるはずだよ。」
  </p>

  <p class="prologue-line is-narrator"
     data-line-id="narrator_4">
    街道の先には、風に揺れる木々と、遠くにかすかに見える石造りの影。<br>
    そこは、この国の運命を左右する分かれ道のひとつだった。
  </p>

  <p class="prologue-line is-fairy"
     data-line-id="fairy_6">
    「ここから先は、どう進むかを決めなきゃいけないみたい。<br>
     <strong><%= current_player&.name_kana || "あなた" %></strong>、準備はいい？」
  </p>
</section>

<hr>

<ul>
  <li>
    <%= link_to "物語を進める",
                branch2_choice_story_path,
                class: "btn" %>
  </li>
</ul>

<div style="margin-top: 16px;">
  <%# ★ 自動再生がブロックされたときだけ表示するボタン %>
  <button id="after-goblin-play" class="btn" style="display:none;">
    ▶ 音声が再生されないときはこちらをクリック
  </button>
</div>

<audio id="after-goblin-audio"></audio>

<script>
  document.addEventListener("turbo:load", function () {
    // このページじゃなければ何もしない（他ページへの影響防止）
    const container = document.getElementById("after-goblin-script");
    if (!container) return;

    // 共通セットアップ関数が無ければ諦める
    if (!window.setupVoicePlayer) {
      console.error("setupVoicePlayer が見つかりません（after_goblin）");
      return;
    }

    // 共通ボイスプレイヤーを起動
    window.setupVoicePlayer({
      // ★ VoicesController::AFTER_GOBLIN_LINES と同じ順にする
      order: [
        "fairy_1",
        "fairy_2",
        "narrator_1",
        "fairy_3",
        "narrator_2",
        "fairy_4",
        "narrator_3",
        "fairy_5",
        "narrator_4",
        "fairy_6"
      ],
      containerSelector: "#after-goblin-script",
      lineSelector: ".prologue-line",
      playButtonSelector: "#after-goblin-play",
      basePath: "/voices/after_goblin"
    });
  });
</script>