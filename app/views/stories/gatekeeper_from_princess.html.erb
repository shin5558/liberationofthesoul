<!-- app/views/stories/gatekeeper_from_princess.html.erb -->

<h1>門前の堅物門番</h1>

<section id="gatekeeper-from-princess-script">
  <!-- 魔姫との別れパート -->
  <p class="prologue-line is-narrator"
     data-line-id="narrator_1">
    あなたが迷いながらも首を横に振ると、<br>
    ルナリアの瞳が、ほんの少しだけ揺れた。
  </p>

  <p class="prologue-line is-princess"
     data-line-id="princess_1">
    「……そう。<br>
     残念だわ。<br>
     手を貸してくれたら、きっと心強かったのだけれど。」
  </p>

  <p class="prologue-line is-fairy"
     data-line-id="fairy_1">
    「ごめんね、ルナリア。<br>
     でも、<%= current_player&.name_kana || "あなた" %> の気持ちも、分かってあげてほしいの。<br>
     いきなり“魔王の娘と組もう”って言われても、簡単には決められないよ。」
  </p>

  <p class="prologue-line is-princess"
     data-line-id="princess_2">
    「分かっているわ。<br>
     わたしだって、立場を逆にされたら、同じように迷うでしょうしね。」
  </p>

  <p class="prologue-line is-narrator"
     data-line-id="narrator_2">
    ルナリアはふっと寂しそうに微笑むと、くるりと背を向けた。
  </p>

  <p class="prologue-line is-princess"
     data-line-id="princess_3">
    「それじゃあ、お互いに――できる場所で戦いましょう。<br>
     あなたたちは、あなたたちのやり方で。<br>
     わたしは、わたしのやり方で。」
  </p>

  <p class="prologue-line is-narrator"
     data-line-id="narrator_3">
    そう言い残し、ルナリアと反乱軍の一行は、路地裏の奥へと姿を消していく。<br>
    残されたのは、静まり返った通りと、胸の奥に残る小さなざわめきだけだった。
  </p>

  <!-- 門前への移動〜門番との対峙パート -->
  <p class="prologue-line is-fairy"
     data-line-id="fairy_2">
    「……行っちゃったね。<br>
     でも、立ち止まってる時間もないし――<br>
     行こう、<%= current_player&.name_kana || "あなた" %>。門の方へ！」
  </p>

  <p class="prologue-line is-narrator"
     data-line-id="narrator_4">
    あなたたちは城下町の大通りへ戻り、<br>
    魔王城へと続く巨大な門の前へとたどり着く。<br>
    高くそびえる城壁と、重厚な門扉が、まるで侵入者を拒むように立ちはだかっていた。
  </p>

  <p class="prologue-line is-gatekeeper"
     data-line-id="gatekeeper_1">
    「……そこの人間、止まれ！」
  </p>

  <p class="prologue-line is-narrator"
     data-line-id="narrator_5">
    厳つい鎧に身を包んだ門番が、槍を地面に突き立てながら、一歩前へと進み出る。<br>
    その目には、敵意というよりも、“職務”としての固い意志が宿っていた。
  </p>

  <p class="prologue-line is-fairy"
     data-line-id="fairy_3">
    「なに、邪魔するの？<br>
     私たち、ただ遊びに来たわけじゃないんだけど。」
  </p>

  <p class="prologue-line is-gatekeeper"
     data-line-id="gatekeeper_2">
    「ああ。<br>
     そういう“決まり”なんでな。<br>
     正体の知れない者を、ここから先へは通せん。」
  </p>

  <p class="prologue-line is-fairy"
     data-line-id="fairy_4">
    「いいの？ そんなことしてて。<br>
     魔王を止めないと、あなたもどうなるか分からないんだよ？」
  </p>

  <p class="prologue-line is-gatekeeper"
     data-line-id="gatekeeper_3">
    「それでも、だ。<br>
     俺は“門を守る者”としてここに立っている。<br>
     その役目を捨てるくらいなら、ここで朽ちるほうがマシだ。」
  </p>

  <p class="prologue-line is-narrator"
     data-line-id="narrator_6">
    まっすぐで、不器用なほど真っ直ぐな言葉。<br>
    それでも、このまま通してくれる気はなさそうだ。
  </p>

  <p class="prologue-line is-fairy"
     data-line-id="fairy_5">
    「はぁ……この堅物には、話を通すだけムダみたいだね。<br>
     仕方ないなぁ。ねぇ、<%= current_player&.name_kana || "あなた" %>――<br>
     倒してでも、進むしかないよ。」
  </p>

  <p class="prologue-line is-narrator"
     data-line-id="narrator_7">
    門番は槍を構え、静かに構えを低くする。<br>
    その姿勢には一切の迷いがなく、<br>
    あなたたちの覚悟を試しているようにも見えた。<br>
    こうして、魔王城の門を守る門番との戦いが幕を開ける――。
  </p>
</section>

<hr>

<ul>
  <li>
    <%# ★ ここは「門番バトル開始」のルートに合わせて調整してください %>
    <%= link_to "門番との戦闘に入る",
            new_battle_path(player_id: current_player&.id, enemy_type: "gatekeeper"),
            class: "btn" %>
  </li>
</ul>

<div style="margin-top: 16px;">
  <%# ★ 自動再生がブロックされたときだけ表示するボタン %>
  <button id="gatekeeper-from-princess-play" class="btn" style="display:none;">
    ▶ 音声が再生されないときはこちらをクリック
  </button>
</div>

<audio id="gatekeeper-from-princess-audio"></audio>

<script>
  document.addEventListener("turbo:load", function () {
    // このページじゃなければ何もしない（他ページへの影響防止）
    const container = document.getElementById("gatekeeper-from-princess-script");
    if (!container) return;

    // 共通セットアップ関数がなければ諦める
    if (!window.setupVoicePlayer) {
      console.error("setupVoicePlayer が見つかりません（gatekeeper_from_princess）");
      return;
    }

    // 共通ボイスプレイヤーを起動
    window.setupVoicePlayer({
      // ★ VoicesController::GATEKEEPER_FROM_PRINCESS_LINES と同じ順番にする
      order: [
        "narrator_1",
        "princess_1",
        "fairy_1",
        "princess_2",
        "narrator_2",
        "princess_3",
        "narrator_3",
        "fairy_2",
        "narrator_4",
        "gatekeeper_1",
        "narrator_5",
        "fairy_3",
        "gatekeeper_2",
        "fairy_4",
        "gatekeeper_3",
        "narrator_6",
        "fairy_5",
        "narrator_7"
      ],
      containerSelector: "#gatekeeper-from-princess-script",
      lineSelector: ".prologue-line",
      playButtonSelector: "#gatekeeper-from-princess-play",
      basePath: "/voices/gatekeeper_from_princess"
    });
  });
</script>