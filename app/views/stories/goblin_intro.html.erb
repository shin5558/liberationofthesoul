<h1>ゴブリンとの遭遇</h1>

<section id="goblin-intro-script" class="story-text-block">
  <p class="prologue-line story-line is-narrator js-line" data-line-id="narrator_1">
    あなたは、まず目の前の脅威に集中することにした。森の奥の声は気になるが、倒れた馬車とゴブリンたちを放置しておくわけにもいかない。
  </p>

  <p class="prologue-line story-line is-fairy js-line" data-line-id="fairy_1">
    「分かった。まずはこのゴブリンたちから片付けよう。あの馬車の人たちが無事かどうか、気になるしね。」
  </p>

  <p class="prologue-line story-line is-narrator js-line" data-line-id="narrator_2">
    足音を殺し、ゴブリンたちとの距離を少しずつ詰めていく。しかし、やがて彼らもこちらの存在に気づき、ぎょろりとした目を向けてきた。
  </p>

  <p class="prologue-line story-line is-goblin js-line" data-line-id="goblin_1">
    「ゲリャッ、ゲリャッ！！」
  </p>

  <p class="prologue-line story-line is-fairy js-line" data-line-id="fairy_2">
    「流石にここまで近づいたら、気づいたみたい。気をつけてね、あの子たち、集団で来ると結構やっかいだから。」
  </p>

  <p class="prologue-line story-line is-narrator js-line" data-line-id="narrator_3">
    ゴブリンたちは歯をむき出しにしながら武器を振り上げ、一斉に飛びかかってくる。ここから――最初の本格的な戦いが始まる。
  </p>
</section>

<hr>

<p>「ゴブリン達との戦闘に入る」</p>
<%= link_to "戦闘開始", new_battle_path(player_id: @player.id, enemy_type: "goblin"), class: "btn" %>

<div style="margin-top: 16px;">
  <button id="goblin-intro-play" class="btn" style="display:none;">
    ▶ 音声が再生されないときはこちらをクリック
  </button>
</div>

<audio id="goblin-intro-audio" style="display:none;"></audio>

<script>
  document.addEventListener("turbo:load", function () {
    // このページじゃなければ何もしない
    const container = document.getElementById("goblin-intro-script");
    if (!container) return;

    // 共通セットアップ関数が無ければ諦める
    if (!window.setupVoicePlayer) {
      console.error("setupVoicePlayer が見つかりません（goblin_intro）");
      return;
    }

    // 共通ボイスプレイヤーを起動
    window.setupVoicePlayer({
      // ★ VoicesController::GOBLIN_INTRO_LINES に合わせる
      order: [
        "narrator_1",
        "fairy_1",
        "narrator_2",
        "goblin_1",
        "fairy_2",
        "narrator_3"
      ],
      containerSelector: "#goblin-intro-script",
      lineSelector: ".prologue-line",
      playButtonSelector: "#goblin-intro-play",  // 自動再生ブロック時のボタン
      basePath: "/voices/goblin_intro"
    });
  });
</script>