<h1>森の手前</h1>

<section id="branch1-choice-script" class="story-text-block">
  <p class="prologue-line story-line is-narrator js-line" data-line-id="narrator_1">
    森の入口へと続く街道。その先で、何かが横たわっている。近づくにつれ、それが横倒しになった馬車と、その周囲をうろつく小さな影だと分かってくる。
  </p>

  <p class="prologue-line story-line is-fairy js-line" data-line-id="fairy_1">
    「……先の方に倒れた馬車と、その近くにゴブリンが三匹いるよ。」
  </p>

  <p class="prologue-line story-line is-narrator js-line" data-line-id="narrator_2">
    耳をすませると、風の流れとは違う、不自然な音が混じっている気がする。
  </p>

  <p class="prologue-line story-line is-voice js-line" data-line-id="voice_1">
    「……たすけて！……」
  </p>

  <p class="prologue-line story-line is-fairy js-line" data-line-id="fairy_2">
    「今のは……、悲鳴……？」
  </p>

  <p class="prologue-line story-line is-narrator js-line" data-line-id="narrator_3">
    道の先では、今にも馬車をあさろうとするゴブリンたち。一方で、森の奥からは、確かに誰かの助けを求める声が聞こえた気がする。
  </p>

  <p class="prologue-line story-line is-fairy js-line" data-line-id="fairy_3">
    「道の先には、馬車とゴブリン。でも、森の方からも誰かの声が聞こえたよ……。どうする？」
  </p>
</section>

<hr>
<ul>
  <li>
    <%= button_to "悲鳴は気のせいだろう。目の前のゴブリンを倒す。",
                  go_goblin_story_path,
                  method: :post,
                  class: "btn" %>
  </li>
  <li>
    <%= button_to "悲鳴が気になる、森の中へ確認に行く。",
                  go_thief_story_path,
                  method: :post,
                  class: "btn" %>
  </li>
</ul>

<div style="margin-top: 16px;">
  <button id="branch1-choice-play" class="btn" style="display:none;">
    ▶ 音声が再生されないときはこちらをクリック
  </button>
</div>

<audio id="branch1-choice-audio" style="display:none;"></audio>

<script>
  document.addEventListener("turbo:load", function () {
    // このページじゃないときは何もしない（Turbo対策）
    const container = document.getElementById("branch1-choice-script");
    if (!container) return;

    // グローバルのセットアップ関数がなければ何もしない
    if (!window.setupVoicePlayer) {
      console.error("setupVoicePlayer が見つかりません");
      return;
    }

    // 共通のボイスプレイヤーを起動
    window.setupVoicePlayer({
      // VoicesController::BRANCH1_LINES と対応する再生順
      order: [
        "narrator_1",
        "fairy_1",
        "narrator_2",
        "voice_1",
        "fairy_2",
        "narrator_3",
        "fairy_3"
      ],
      containerSelector: "#branch1-choice-script",
      lineSelector: ".prologue-line",
      playButtonSelector: "#branch1-choice-play",
      basePath: "/voices/branch1"
    });
  });
</script>