<h1>プロローグ</h1>

<section id="prologue-script">
  <p class="prologue-line prologue-line--narrator is-narrator"
     data-line-id="narrator_1">
    闇がゆっくりと世界を覆いはじめた頃――
    山と森に囲まれた小さな王国で、一人の冒険者が静かに目を覚ます。
  </p>

  <p class="prologue-line prologue-line--narrator is-narrator"
     data-line-id="narrator_2">
    その名は <strong><%= current_player&.name_kana || "あなた" %></strong>。<br>
    まだ自分の運命も、この国に迫る脅威の正体も知らないまま…。
  </p>

  <p class="prologue-line prologue-line--fairy is-fairy"
     data-line-id="fairy_1">
    「……あ、やっと起きた。ふふ、ずっと待ってたんだよ。<br>
     わたしはリュミエル。これからあなたのそばで案内役をする妖精です。」
  </p>

  <p class="prologue-line prologue-line--fairy is-fairy"
     data-line-id="fairy_2">
    「怖がらなくて大丈夫。世界が少し暗くなっていても、<br>
     あなたと一緒なら、きっと光を取り戻せるから。」
  </p>
</section>

<hr>

<p>物語を進めましょう。</p>
<ul>
  <li><%= link_to "第1戦へ進む（分岐1へ）", branch1_choice_story_path, class: "btn" %></li>
</ul>

<div style="margin-top: 16px;">
  <%# ★ 自動再生がブロックされたときだけ JS から表示するボタン %>
  <button id="prologue-play" class="btn" style="display:none;">
    ▶ 音声が再生されないときはこちらをクリック
  </button>
</div>

<audio id="prologue-audio" style="display:none;"></audio>

<script>
  document.addEventListener("turbo:load", function () {
    // このページじゃなければ何もしない
    const container = document.getElementById("prologue-script");
    if (!container) return;

    // グローバルのセットアップ関数が無ければ諦める
    if (!window.setupVoicePlayer) {
      console.error("setupVoicePlayer が見つかりません");
      return;
    }

    // 共通のボイスプレイヤーを起動
    window.setupVoicePlayer({
      order: ["narrator_1", "narrator_2", "fairy_1", "fairy_2"],
      containerSelector: "#prologue-script",
      lineSelector: ".prologue-line",
      playButtonSelector: "#prologue-play",
      basePath: "/voices/prologue"
    });
  });
</script>