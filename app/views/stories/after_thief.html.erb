<!-- app/views/stories/after_thief.html.erb -->

<h1>盗賊団を退けて</h1>

<section id="after-thief-script">
  <p class="prologue-line is-narrator"
     data-line-id="narrator_1">
    盗賊たちが地面に倒れ込み、森の中にあった緊張がすっと解けていく。<br>
    さっきまで響いていた怒号も、今はただ、静かな風の音にかき消されていた。
  </p>

  <p class="prologue-line is-fairy"
     data-line-id="fairy_1">
    「やったー！ 土竜どもを、まとめてやっつけたよ！」
  </p>

  <p class="prologue-line is-narrator"
     data-line-id="narrator_2">
    リュミエルがくるりと一回転すると、淡い光の粉が周囲にふわりと舞い散る。<br>
    縄で縛られていた女性も、ようやくその場の空気が変わったことに気づいたようだった。
  </p>

  <p class="prologue-line is-voice"
     data-line-id="woman_1">
    「あ、あの……助けてくださって、本当にありがとうございます……！」
  </p>

  <p class="prologue-line is-fairy"
     data-line-id="fairy_2">
    「――あ、そういえばいたね。すっかり忘れてたよ。」
  </p>

  <p class="prologue-line is-narrator"
     data-line-id="narrator_3">
    あまりに遠慮のないその一言に、女性は思わず肩を落とした。
  </p>

  <p class="prologue-line is-voice"
     data-line-id="woman_2">
    「うぅ……慣れてますから、いいですけど……。<br>
     ……ええと、それよりも、お礼にこちらを受け取ってください。」
  </p>

  <p class="prologue-line is-narrator"
     data-line-id="narrator_4">
    女性が差し出したのは、淡い光を帯びたカードセットだった。<br>
    手にした瞬間、指先に小さな鼓動のような力が伝わってくる。
  </p>

  <p class="prologue-line is-voice"
     data-line-id="woman_3">
    「旅の途中で拾った、不思議なカードなんです。<br>
     わたしよりも、あなた達のほうがきっと上手く使えると思って……。」
  </p>

  <p class="prologue-line is-fairy"
     data-line-id="fairy_3">
    「わぁ、ありがとう！ 属性カードだね。<br>
     誰でも使える、便利なやつだよ。」
  </p>

  <p class="prologue-line is-narrator"
     data-line-id="narrator_5">
    カードは、あなたのデッキの中に自然と溶け込むように納まっていく。<br>
    新たな一手を手に入れたという実感が、心を少しだけ軽くした。
  </p>

  <p class="prologue-line is-voice"
     data-line-id="woman_4">
    「わたしは、一度家に戻ります。<br>
     本当にありがとうございました。それでは、失礼します。」
  </p>

  <p class="prologue-line is-narrator"
     data-line-id="narrator_6">
    女性は何度も振り返りながら頭を下げると、森の出口のほうへと小走りに去っていった。
  </p>

  <p class="prologue-line is-fairy"
     data-line-id="fairy_4">
    「バイバーイ！　……ふぅ、なんとか一件落着だね。」
  </p>

  <p class="prologue-line is-narrator"
     data-line-id="narrator_7">
    残されたのは、静けさと、倒れた盗賊たち、そして新しく手に入れたカードだけ。<br>
    森の奥から吹き抜けた風が、あなたたちの背中をそっと押す。<br>
  </p>
</section>

<hr>

<ul>
  <li>
    <%= link_to "物語を進める", branch2_choice_story_path, class: "btn" %>
  </li>
</ul>

<div style="margin-top: 16px;">
  <%# ★ 自動再生がブロックされたときだけ表示するボタン %>
  <button id="after-thief-play" class="btn" style="display:none;">
    ▶ 音声が再生されないときはこちらをクリック
  </button>
</div>

<audio id="after-thief-audio"></audio>

<script>
  document.addEventListener("turbo:load", function () {
    // このページじゃなければ何もしない（他ページへの影響を防ぐ）
    const container = document.getElementById("after-thief-script");
    if (!container) return;

    // 共通セットアップ関数がなければ諦める
    if (!window.setupVoicePlayer) {
      console.error("setupVoicePlayer が見つかりません（after_thief）");
      return;
    }

    // 共通ボイスプレイヤーを起動
    window.setupVoicePlayer({
      // ★ VoicesController::AFTER_THIEF_LINES と同じ順にする
      order: [
        "narrator_1",
        "fairy_1",
        "narrator_2",
        "woman_1",
        "fairy_2",
        "narrator_3",
        "woman_2",
        "narrator_4",
        "woman_3",
        "fairy_3",
        "narrator_5",
        "woman_4",
        "narrator_6",
        "fairy_4",
        "narrator_7"
      ],
      containerSelector: "#after-thief-script",
      lineSelector: ".prologue-line",
      playButtonSelector: "#after-thief-play",
      basePath: "/voices/after_thief"
    });
  });
</script>